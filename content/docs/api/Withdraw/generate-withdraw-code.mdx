---
title: Generate Withdraw Code
description: Request email verification code for user withdrawal operations
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Card, Cards } from 'fumadocs-ui/components/card';

<div className="relative overflow-hidden rounded-2xl bg-gradient-to-br from-rose-500/10 via-pink-500/5 to-background p-8 border border-rose-500/20 mb-8">
  <div className="relative z-10">
    <h1 className="text-3xl md:text-4xl font-bold mb-4">
      Generate Withdraw Code
    </h1>
    <p className="text-lg text-muted-foreground mb-4">
      Request email verification code for secure withdrawal operations
    </p>
    <div className="inline-block px-3 py-1 rounded-full bg-rose-500/20 border border-rose-500/30 text-rose-400 text-sm font-medium">
      USER Operation
    </div>
  </div>
  <div className="absolute top-0 right-0 w-48 h-48 bg-rose-500/5 rounded-full blur-3xl"></div>
</div>

## Overview

The `generateWithdraw` mutation allows users to generate an email verification code required for all withdrawal operations. This is the first step in the withdrawal process and ensures only authorized users can initiate fund withdrawals.

<Callout type="info" title="Required for All Withdrawals">
This verification code must be obtained before submitting any withdrawal request (crypto, fiat, or PayPal).
</Callout>

## GraphQL Schema

<div className="rounded-xl border border-rose-500/30 bg-gradient-to-br from-rose-500/10 to-rose-500/5 p-6 my-6">
  <div className="flex items-center gap-3 mb-4">
    <span className="text-2xl">üìß</span>
    <div>
      <div className="font-bold text-lg">Mutation Schema</div>
      <div className="text-sm text-muted-foreground">Generate email verification code</div>
    </div>
  </div>

  ```graphql
  generateWithdraw: String
  ```
</div>

## Parameters

<div className="rounded-lg border border-border bg-muted/30 p-5 my-6">
  <div className="flex items-center gap-2 mb-3">
    <span className="text-lg">üìã</span>
    <span className="font-bold">No Parameters Required</span>
  </div>

  <div className="text-sm text-muted-foreground">
    This mutation does not require any input parameters. The verification code is automatically sent to the email address associated with the authenticated user's account.
  </div>
</div>

## Return Value

<div className="rounded-xl border border-green-500/30 bg-gradient-to-br from-green-500/10 to-green-500/5 p-6 my-6">
  <div className="flex items-center gap-3 mb-4">
    <span className="text-2xl">‚úÖ</span>
    <div>
      <div className="font-bold text-lg">String Response</div>
      <div className="text-sm text-muted-foreground">Success status message</div>
    </div>
  </div>

  <div className="space-y-3">
    <div className="p-4 rounded-lg bg-background border border-border">
      <div className="font-semibold mb-2">Return Type: <code className="bg-muted px-2 py-1 rounded text-sm">String</code></div>
      <div className="text-sm text-muted-foreground mb-3">
        Returns "Success" if the verification code email was sent successfully, otherwise returns an error message.
      </div>

      <div className="grid grid-cols-2 gap-3 text-xs">
        <div className="p-3 rounded bg-green-500/10 border border-green-500/20">
          <div className="font-semibold text-green-400 mb-1">Success Response</div>
          <code className="text-muted-foreground">"Success"</code>
        </div>
        <div className="p-3 rounded bg-red-500/10 border border-red-500/20">
          <div className="font-semibold text-red-400 mb-1">Error Response</div>
          <code className="text-muted-foreground">Error message</code>
        </div>
      </div>
    </div>
  </div>
</div>

## Example Mutation

<div className="my-6">
  <div className="font-bold mb-3 flex items-center gap-2">
    <span>üíª</span>
    <span>Request Verification Code</span>
  </div>

  ```graphql
  mutation {
    generateWithdraw
  }
  ```

  <div className="mt-4 p-4 rounded-lg border border-border bg-muted/30">
    <div className="font-semibold text-sm mb-2">Expected Response</div>
    ```json
    {
      "data": {
        "generateWithdraw": "Success"
      }
    }
    ```
  </div>
</div>

## Use Cases

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
  <div className="p-5 rounded-lg border border-border bg-muted/50">
    <div className="text-xl mb-2">‚Çø</div>
    <div className="font-bold mb-2">Crypto Withdrawals</div>
    <div className="text-sm text-muted-foreground">
      Generate code before withdrawing cryptocurrency to external wallets
    </div>
  </div>

  <div className="p-5 rounded-lg border border-border bg-muted/50">
    <div className="text-xl mb-2">üè¶</div>
    <div className="font-bold mb-2">Bank Transfers</div>
    <div className="text-sm text-muted-foreground">
      Verify identity before initiating fiat bank withdrawal requests
    </div>
  </div>

  <div className="p-5 rounded-lg border border-border bg-muted/50">
    <div className="text-xl mb-2">üí≥</div>
    <div className="font-bold mb-2">PayPal Payments</div>
    <div className="text-sm text-muted-foreground">
      Secure PayPal withdrawal initiation with email verification
    </div>
  </div>

  <div className="p-5 rounded-lg border border-border bg-muted/50">
    <div className="text-xl mb-2">üîê</div>
    <div className="font-bold mb-2">Security Verification</div>
    <div className="text-sm text-muted-foreground">
      Confirm user identity before any fund withdrawal operations
    </div>
  </div>
</div>

## Implementation Example

<div className="my-6">
  <div className="font-bold mb-3">Complete Withdrawal Flow</div>

  ```typescript
  // User initiates withdrawal process
  async function initiateWithdrawal(amount: number, currency: string) {
    try {
      // Step 1: Generate verification code
      const codeRequest = await client.request(gql`
        mutation {
          generateWithdraw
        }
      `);

      if (codeRequest.generateWithdraw !== 'Success') {
        throw new Error('Failed to send verification code');
      }

      console.log('‚úÖ Verification code sent to your email');

      // Step 2: Prompt user to enter code from email
      const verificationCode = await promptUserForCode();

      // Step 3: Submit withdrawal with verification code
      const withdrawal = await client.request(gql`
        mutation WithdrawCrypto(
          $amount: Float!,
          $sourceToken: String!,
          $network: String!,
          $des: String!,
          $code: String!
        ) {
          cryptoWithdrawRequest(
            amount: $amount,
            sourceToken: $sourceToken,
            network: $network,
            des: $des,
            code: $code
          ) {
            id
            status
            createdAt
          }
        }
      `, {
        amount,
        sourceToken: currency,
        network: 'ERC20',
        des: userWalletAddress,
        code: verificationCode
      });

      console.log('‚úÖ Withdrawal request submitted:', withdrawal);

    } catch (error) {
      console.error('‚ùå Withdrawal failed:', error);
    }
  }
  ```
</div>

## Workflow Diagram

<div className="rounded-xl border border-rose-500/30 bg-gradient-to-br from-rose-500/10 to-rose-500/5 p-6 my-6">
  <div className="font-bold text-lg mb-4">Withdrawal Verification Flow</div>

  <div className="space-y-4">
    <div className="flex items-start gap-3">
      <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-500 font-bold flex-shrink-0">1</div>
      <div>
        <div className="font-bold text-sm">User Calls generateWithdraw</div>
        <div className="text-xs text-muted-foreground mt-1">System sends verification code to user's registered email</div>
      </div>
    </div>

    <div className="flex items-start gap-3">
      <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-500 font-bold flex-shrink-0">2</div>
      <div>
        <div className="font-bold text-sm">User Receives Email</div>
        <div className="text-xs text-muted-foreground mt-1">Email contains time-limited verification code (typically 6 digits)</div>
      </div>
    </div>

    <div className="flex items-start gap-3">
      <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-500 font-bold flex-shrink-0">3</div>
      <div>
        <div className="font-bold text-sm">User Enters Code</div>
        <div className="text-xs text-muted-foreground mt-1">User inputs verification code into withdrawal form</div>
      </div>
    </div>

    <div className="flex items-start gap-3">
      <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-500 font-bold flex-shrink-0">4</div>
      <div>
        <div className="font-bold text-sm">Submit Withdrawal Request</div>
        <div className="text-xs text-muted-foreground mt-1">User submits withdrawal with code via appropriate mutation</div>
      </div>
    </div>

    <div className="flex items-start gap-3">
      <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-500 font-bold flex-shrink-0">5</div>
      <div>
        <div className="font-bold text-sm">System Validates Code</div>
        <div className="text-xs text-muted-foreground mt-1">Backend verifies code matches and hasn't expired</div>
      </div>
    </div>
  </div>
</div>

## Security Features

<div className="rounded-xl border border-red-500/30 bg-gradient-to-br from-red-500/10 to-red-500/5 p-6 my-6">
  <div className="font-bold text-lg mb-4 flex items-center gap-2">
    <span>üîí</span>
    <span>Security Measures</span>
  </div>

  <div className="space-y-3">
    <div className="flex items-start gap-3 p-4 rounded-lg bg-background border border-border">
      <div className="text-xl">üìß</div>
      <div className="flex-1">
        <div className="font-bold text-sm">Email Verification</div>
        <div className="text-xs text-muted-foreground mt-1">
          Code sent only to user's verified email address on file
        </div>
      </div>
    </div>

    <div className="flex items-start gap-3 p-4 rounded-lg bg-background border border-border">
      <div className="text-xl">‚è±Ô∏è</div>
      <div className="flex-1">
        <div className="font-bold text-sm">Time-Limited Codes</div>
        <div className="text-xs text-muted-foreground mt-1">
          Verification codes expire after a short time period (typically 10-15 minutes)
        </div>
      </div>
    </div>

    <div className="flex items-start gap-3 p-4 rounded-lg bg-background border border-border">
      <div className="text-xl">üî¢</div>
      <div className="flex-1">
        <div className="font-bold text-sm">Single-Use Codes</div>
        <div className="text-xs text-muted-foreground mt-1">
          Each code can only be used once for a single withdrawal request
        </div>
      </div>
    </div>

    <div className="flex items-start gap-3 p-4 rounded-lg bg-background border border-border">
      <div className="text-xl">üîê</div>
      <div className="flex-1">
        <div className="font-bold text-sm">Authentication Required</div>
        <div className="text-xs text-muted-foreground mt-1">
          User must be authenticated before requesting verification codes
        </div>
      </div>
    </div>
  </div>
</div>

## Best Practices

<div className="space-y-3 my-6">
  <div className="p-4 rounded-lg border border-border bg-muted/30">
    <div className="flex items-start gap-3">
      <span className="text-lg">‚úÖ</span>
      <div>
        <div className="font-bold text-sm">Request Code Just Before Withdrawal</div>
        <div className="text-xs text-muted-foreground mt-1">
          Generate the verification code immediately before filling out the withdrawal form to minimize expiration risk
        </div>
      </div>
    </div>
  </div>

  <div className="p-4 rounded-lg border border-border bg-muted/30">
    <div className="flex items-start gap-3">
      <span className="text-lg">‚úÖ</span>
      <div>
        <div className="font-bold text-sm">Check Email Spam Folder</div>
        <div className="text-xs text-muted-foreground mt-1">
          Inform users to check spam/junk folders if code doesn't arrive within a few minutes
        </div>
      </div>
    </div>
  </div>

  <div className="p-4 rounded-lg border border-border bg-muted/30">
    <div className="flex items-start gap-3">
      <span className="text-lg">‚úÖ</span>
      <div>
        <div className="font-bold text-sm">Implement Rate Limiting</div>
        <div className="text-xs text-muted-foreground mt-1">
          Prevent abuse by limiting how many verification codes can be requested per time period
        </div>
      </div>
    </div>
  </div>

  <div className="p-4 rounded-lg border border-border bg-muted/30">
    <div className="flex items-start gap-3">
      <span className="text-lg">‚úÖ</span>
      <div>
        <div className="font-bold text-sm">Provide Clear UI Feedback</div>
        <div className="text-xs text-muted-foreground mt-1">
          Show clear success message when code is sent and countdown timer for code expiration
        </div>
      </div>
    </div>
  </div>

  <div className="p-4 rounded-lg border border-border bg-muted/30">
    <div className="flex items-start gap-3">
      <span className="text-lg">‚ùå</span>
      <div>
        <div className="font-bold text-sm">Don't Store Codes Client-Side</div>
        <div className="text-xs text-muted-foreground mt-1">
          Never store verification codes in browser storage or logs for security
        </div>
      </div>
    </div>
  </div>
</div>

## Error Handling

<div className="my-6">
  ```typescript
  async function generateWithdrawCode() {
    try {
      const result = await client.request(gql`
        mutation {
          generateWithdraw
        }
      `);

      if (result.generateWithdraw === 'Success') {
        showSuccessNotification('Verification code sent to your email');
        startCodeExpirationTimer(15 * 60); // 15 minutes
      } else {
        throw new Error(result.generateWithdraw);
      }

    } catch (error) {
      if (error.message.includes('rate limit')) {
        showErrorNotification('Too many requests. Please wait before requesting another code.');
      } else if (error.message.includes('email')) {
        showErrorNotification('Email delivery failed. Please verify your email address.');
      } else {
        showErrorNotification('Failed to generate verification code. Please try again.');
      }
      console.error('Code generation error:', error);
    }
  }
  ```
</div>

## Related Operations

<Cards>
  <Card
    title="Crypto Withdrawal Request"
    href="/docs/api/Withdraw/crypto-withdrawal-request"
    description="Submit cryptocurrency withdrawal with verification code"
  />
  <Card
    title="Fiat Withdrawal Request"
    href="/docs/api/Withdraw/fiat-withdrawal-request"
    description="Submit bank transfer withdrawal with verification code"
  />
  <Card
    title="PayPal Withdrawal Request"
    href="/docs/api/Withdraw/paypal-withdraw-request"
    description="Submit PayPal withdrawal with verification code"
  />
  <Card
    title="Withdrawal Overview"
    href="/docs/api/Withdraw/withdraw-summary"
    description="Complete withdrawal API system documentation"
  />
</Cards>

<div className="mt-8 p-6 rounded-xl border border-rose-500/30 bg-gradient-to-r from-rose-500/10 to-pink-500/10">
  <div className="flex items-center gap-3">
    <span className="text-2xl">üîê</span>
    <div>
      <div className="font-bold">First Step to Secure Withdrawals</div>
      <div className="text-sm text-muted-foreground">Always generate a fresh verification code for each withdrawal to ensure maximum security</div>
    </div>
  </div>
</div>
